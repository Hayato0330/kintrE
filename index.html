<!DOCTYPE html> 
<html lang="ja"> 
  <head>
     <meta charset="UTF-8">
      <title>口座画面</title>
       <link rel="stylesheet" href="css/index.css">
       </head> 
      <body> 
        <div class="phone"> 
          <div class="screen"> 
            <div class="profile"> 
              <img src="human1.png" alt="アイコン">
               <p class="name">サンプル 氏名</p> 
              </div>
               <p class="account">口座番号：0000000</p> 
               
               
               <!-- 上限金額-->
                 <div class="row">
                   <div class="label" >残高</div> 
                   <div class="value"><span id="limit">0</span> 円</div> 
                  </div> 
                  <hr style="border:none;border-top:1px solid #eee;margin:12px 0;"> 
                  
                  
                  
               <!-- 送金「」円 --> 
                <div class="row" style="align-items:flex-end;"> 
                  <div> 
                    <div class="label">送金</div> 
                    <button class="primary" id="sendBtn">送金</button> 
                    <div id="msg" class="">

                    </div>
                   </div> 

                   <script>
                    document.getElementById("sendBtn").addEventListener("click", () => {
                      const acct = window.currentAccountNumber ?? document.getElementById("account-number").textContent.trim();
                      location.href = "pages/human_select.html?number=${encodeURIComponent(acct)}";
                    });
                   </script>

                <!--請求-->
                 <div class="row" style="align-items:flex-end;">
                   <div>
                     <div class="label">請求</div>
                      <button class="primary" id="requestBtn">請求</button>
                       <div id="msg" class=""></div>
                    </div>
                  </div> 

  <script>
    document.getElementById("requestBtn").addEventListener("click", () => {
      location.href = "pages/7-1.html";
    });
  </script>
        </div>
  <script>
    (async () => {
      const accountNumber = "100001";

      try {
        const res = await fetch(`/api/accounts?number=${encodeURIComponent(accountNumber)}`);
        const data = await res.json();

        if (!res.ok) {
          document.getElementById("msg").textContent = data?.error ?? "読み込みに失敗しました";
          return;
        }

        // 表示更新
        document.getElementById("user-name").textContent = data.name ?? "---";
        document.getElementById("account-number").textContent = data.account_number ?? accountNumber;
        document.getElementById("limit").textContent = Number(data.balance ?? 0).toLocaleString("ja-JP");

        window.currentAccountNumber = data.account_number ?? accountNumber;

        // アイコン（aiconをicon_urlとして返している想定）
        const icon = data.icon_url ?? "https://via.placeholder.com/60";

        document.getElementById("user_icon").src = icon;

      } catch (e) {
        document.getElementById("msg").textContent = "通信エラーです";
      }
    })();
  </script>

                       </div>
                       </div>
                       </div> 
                      </div> 
        </body> 
 </html> 
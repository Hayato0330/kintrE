<!DOCTYPE html> 
<html lang="ja"> 
  <head>
     <meta charset="UTF-8">
      <title>口座画面</title>
       <link rel="stylesheet" href="pages/style.css">
       </head> 

       

      <body> 
        <div class="phone">
          <div class="screen">
            <div class="center-box"> 
              <div class="profile">
                <img id="user_icon" src="https://via.placeholder.com/60" alt="アイコン">
                <p class="name" id="user-name">---</p>
              </div>
              <p class="account">
              口座番号：<span id="account-number">0000000</span>
              </p>
               
               
               <!-- 残高-->
              <div class="row">
                <div class="label" >残高</div> 
                <div class="value"><span id="limit">0</span> 円</div> 
                </div> 
                <hr style="border:none;border-top:1px solid #eee;margin:12px 0;"> 
                  
                  
                  
      <!-- 送金する -->
      <button class="primary" type="button"  id="sendBtn">
        送金する
      </button>

      <!-- 請求する -->
      <button class="primary" type="button"  id="requestBtn">
        請求する
      </button>

      <!-- 請求履歴 -->
      <button class="primary" type="button"  id="historyBtn">
        請求履歴
      </button>


<script>
  document.getElementById("sendBtn").addEventListener("click", () => {
    const acct = window.currentAccountNumber ??
      document.getElementById("account-number")?.textContent?.trim();

    if (!acct) {
      document.getElementById("msg").textContent = "口座番号が取得できません";
      return;
    }
    sessionStorage.setItem('target_account_number', acct);
    location.href = "pages/human_select.html";
  });

  document.getElementById("requestBtn").addEventListener("click", () => {
    // acct変数をここでも定義する
    const acct = window.currentAccountNumber ??
      document.getElementById("account-number")?.textContent?.trim();
    
    if (!acct) {
      return;
    }
    sessionStorage.setItem('target_account_number', acct);
    location.href = "pages/7-1.html";
  });

  document.getElementById("historyBtn").addEventListener("click", () => {
    // acct変数をここでも定義する & IDをhistoryBtnに修正
    const acct = window.currentAccountNumber ??
      document.getElementById("account-number")?.textContent?.trim();
    
    if (!acct) {
      return;
    }
    sessionStorage.setItem('target_account_number', acct);
    location.href = "pages/9.html";
  });
</script>


  <script>
    (async () => {
      const accountNumber = "100001"; // ここを固定で10001にする

      try {
        const res = await fetch(`/api/accounts?number=${encodeURIComponent(accountNumber)}`);
        const data = await res.json();

        if (!res.ok) {
          document.getElementById("msg").textContent = data?.error ?? "読み込みに失敗しました";
          return;
        }

        // 表示更新
        document.getElementById("user-name").textContent = data.name ?? "---";
        document.getElementById("account-number").textContent = data.account_number ?? accountNumber;
        document.getElementById("limit").textContent = Number(data.balance ?? 0).toLocaleString("ja-JP");

        window.currentAccountNumber = data.account_number ?? accountNumber;

        // アイコン（aiconをicon_urlとして返している想定）
        const icon = data.icon_url ?? "https://via.placeholder.com/60";
        document.getElementById("user_icon").src = icon;

      } catch (e) {
        document.getElementById("msg").textContent = "通信エラーです";
      }
    })();
  </script>
</div>
</div>
</div>
</div>
</body> 
</html> 